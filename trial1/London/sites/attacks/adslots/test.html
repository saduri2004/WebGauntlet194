<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Adslot Attacks Test</title>
    <!-- Base styles -->
    <link rel="stylesheet" href="adslot.css">
    <link rel="stylesheet" href="../css_configs/normal_theme.css" id="base-theme">
    <style>
        body { font-family: Arial, sans-serif; width: 100%; margin: 0; padding: 20px; background-color: #f4f4f4; }
        .attack-section { background-color: white; border: 1px solid #e0e0e0; margin-bottom: 20px; padding: 15px; border-radius: 5px; }
        button { margin: 10px 5px; padding: 10px 15px; background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background-color: #0056b3; }
        #theme-selector { margin-bottom: 20px; text-align: center; }
        #error-display { color: red; margin: 10px 0; text-align: center; }
    </style>
</head>
<body>
    <h1>Adslot Attacks Test Page</h1>

    <div id="theme-selector">
        <label for="theme-select">Select Theme: </label>
        <select id="theme-select">
            <option value="normal">Normal</option>
            <option value="red">Red</option>
            <option value="black">Black</option>
            <option value="fun">Fun</option>
            <option value="scam">Scam</option>
        </select>
    </div>

    <div id="error-display"></div>

    <div class="attack-section">
        <h2>Checkout Attacks</h2>
        <button onclick="loadCheckoutAgentJailbreak()">Checkout Agent Jailbreak</button>
        <button onclick="loadPhishingFormScam()">Phishing Form Scam</button>
    </div>

    <div class="attack-section">
        <h2>Main Page Attacks</h2>
        <button onclick="loadMainAgentJailbreak()">Main Agent Jailbreak</button>
        <button onclick="loadCategorySaleScam()">Category Sale Scam</button>
    </div>

    <div class="attack-section">
        <h2>Product Page Attacks</h2>
        <button onclick="loadProductAgentJailbreak()">Product Agent Jailbreak</button>
        <button onclick="loadProductDiscountAdslot()">Product Discount Scam</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script type="module">
        const errorDisplay = document.getElementById('error-display');
        const themeSelect = document.getElementById('theme-select');
        const baseTheme = document.getElementById('base-theme');
        
        // Update base theme when dropdown changes
        themeSelect.addEventListener('change', (e) => {
            baseTheme.href = `../css_configs/${e.target.value}_theme.css`;
        });
        
        async function safeImportAndExecute(modulePath, createFunction) {
            try {
                errorDisplay.textContent = '';
                const module = await import(modulePath);
                const adslotCreator = module[createFunction];
                
                if (!adslotCreator) {
                    throw new Error(`Function ${createFunction} not found in module`);
                }
                
                const existingAdslot = document.querySelector('.adslot');
                if (existingAdslot) {
                    existingAdslot.remove();
                }
                
                adslotCreator({
                    theme: themeSelect.value
                });
            } catch (error) {
                console.error('Import or execution error:', error);
                errorDisplay.textContent = `Error: ${error.message}. Check console for details.`;
            }
        }

        window.loadCheckoutAgentJailbreak = () => safeImportAndExecute('./checkout/agent_jailbreak_adverserial.js', 'createAgentJailbreakAdslot');
        window.loadPhishingFormScam = () => safeImportAndExecute('./checkout/phishing_form_scam.js', 'createPhishingCheckoutAdslot');
        window.loadMainAgentJailbreak = () => safeImportAndExecute('./main/agent_jailbreak_adverserial.js', 'createAgentJailbreakAdslot');
        window.loadCategorySaleScam = () => safeImportAndExecute('./main/category_sale_scam.js', 'createCategorySaleScamAdslot');
        window.loadProductAgentJailbreak = () => safeImportAndExecute('./product/agent_jailbreak_adverserial.js', 'createAgentJailbreakAdslot');
        window.loadProductDiscountAdslot = () => safeImportAndExecute('./product/product_discount_discount.js', 'createProductDiscountAdslot');
    </script>
</body>
</html>