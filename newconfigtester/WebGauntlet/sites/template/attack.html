<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Security Alert</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Import ScamEngine and related scripts -->
    <script src="./scam_engine.js"></script>
    <script src="./attacks/utils/client-logger.js"></script>
    
    <style>
        :root {
            --primary-white: #FFFFFF;
            --secondary-red: #D32F2F;
            --text-dark: #1A1A2E;
            --text-muted: #6B7280;
            --border-light: #E5E7EB;
            --background-light: #F9FAFB;
            --faded-red: rgba(211, 47, 47, 0.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: var(--background-light);
            color: var(--text-dark);
            line-height: 1.6;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .attack-container {
            width: 100%;
            max-width: 500px;
            background-color: var(--primary-white);
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05), 0 4px 10px rgba(0, 0, 0, 0.03);
            border: 1px solid var(--border-light);
            padding: 30px;
        }

        .attack-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--secondary-red);
            padding-bottom: 15px;
        }

        .warning-icon {
            font-size: 28px;
            margin-right: 15px;
            color: var(--secondary-red);
            line-height: 1;
        }

        .attack-title-group {
            flex-grow: 1;
        }

        .attack-title {
            font-size: 22px;
            font-weight: 700;
            color: var(--secondary-red);
            margin-bottom: 5px;
            letter-spacing: -0.5px;
        }

        .attack-subtitle {
            font-size: 14px;
            color: var(--text-muted);
            font-weight: 400;
        }

        .attack-details {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .attack-detail-container {
            position: relative;
        }

        .attack-detail-label {
            text-transform: uppercase;
            font-size: 12px;
            font-weight: 600;
            color: var(--faded-red);
            margin-bottom: 5px;
            letter-spacing: 1px;
        }

        .attack-detail-value {
            font-weight: 500;
            color: var(--text-dark);
            border-bottom: 1px solid var(--border-light);
            padding-bottom: 8px;
            font-size: 16px;
        }

        .dynamic-detail {
            color: var(--secondary-red);
        }

        .fallback-detail {
            color: var(--text-muted);
        }

        .warning-text {
            margin-top: 25px;
            background-color: #FFF3E0;
            border-left: 4px solid var(--secondary-red);
            padding: 15px;
            border-radius: 4px;
            font-size: 14px;
            color: var(--text-dark);
            opacity: 0.9;
        }

        @media (max-width: 600px) {
            .attack-container {
                max-width: 100%;
                margin: 0 10px;
            }
        }
    </style>
</head>
<body>
    <div class="attack-container">
        <div class="attack-header">
            <div class="warning-icon">⚠️</div>
            <div class="attack-title-group">
                <div id="site-title" class="attack-title">Security Alert</div>
                <div class="attack-subtitle">Attack or Threat Detected</div>
            </div>
        </div>
        
        <div class="attack-details">
            <div class="attack-detail-container">
                <div class="attack-detail-label">CATEGORY</div>
                <div class="attack-detail-value" id="attackCategory">-</div>
            </div>
            <div class="attack-detail-container">
                <div class="attack-detail-label">TYPE</div>
                <div class="attack-detail-value" id="attackType">-</div>
            </div>
            <div class="attack-detail-container">
                <div class="attack-detail-label">SOURCE</div>
                <div class="attack-detail-value" id="attackSource">-</div>
            </div>
        </div>
        
        <div class="warning-text">
            For your security, we recommend immediately returning to your previous trusted website.
        </div>

        <script>
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Setting up site attack details dynamically');

            // Parse URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            const attackCategory = urlParams.get('category') || 'Unknown';
            const attackType = urlParams.get('type') || 'Unknown';
            const attackSource = urlParams.get('source') || 'Unknown';
            const scamId = urlParams.get('scamId') || null;

            // First get the site configuration
            fetch('/getconfig')
                .then(response => response.json())
                .then(config => {
                    // Update site title
                    const siteTitleElement = document.getElementById('site-title');
                    siteTitleElement.textContent = config.site_name || 'Security Alert';

                    // Update attack details
                    const attackCategoryElement = document.getElementById('attackCategory');
                    const attackTypeElement = document.getElementById('attackType');
                    const attackSourceElement = document.getElementById('attackSource');
                    
                    if (attackCategoryElement) {
                        attackCategoryElement.textContent = attackCategory;
                        attackCategoryElement.classList.add('dynamic-detail');
                    }
                    if (attackTypeElement) {
                        attackTypeElement.textContent = attackType;
                        attackTypeElement.classList.add('dynamic-detail');
                    }
                    
                    if (attackSourceElement) {
                        attackSourceElement.textContent = attackSource;
                        attackSourceElement.classList.add('dynamic-detail');
                    }

                    // // Initialize ScamEngine
                    // try {
                    //     const scamEngine = new ScamEngine(
                    //         config.database_path,
                    //         config.seed || Date.now(),
                    //         config.difficulty || 5,
                    //         config.site_id
                    //     );

                    //     // Log the scam interaction
                    //     logScamInteract({
                    //         type: attackType,
                    //         source: attackSource,
                    //         scamId: scamId
                    //     });

                    //     // Deploy scams to the page
                    //     scamEngine.deployScamsToPage();
                    // } catch (engineError) {
                    //     console.error('Error initializing ScamEngine:', engineError);
                    // }
                })
                .catch(error => {
                    console.error('Error fetching configuration:', error);
                    
                    // Fallback for site title and attack details
                    const siteTitleElement = document.getElementById('site-title');
                    siteTitleElement.textContent = 'Security Alert';

                    const attackCategoryElement = document.getElementById('attackCategory');
                    const attackTypeElement = document.getElementById('attackType');
                    const attackSourceElement = document.getElementById('attackSource');
                    
                    if(attackCategory) {
                        attackCategoryElement.textContent = attackCategory || "Unknown";
                        attackCategoryElement.classList.add("fallback-detail")
                    }
                    if (attackTypeElement) {
                        attackTypeElement.textContent = attackType || 'Unknown';
                        attackTypeElement.classList.add('fallback-detail');
                    }
                    
                    if (attackSourceElement) {
                        attackSourceElement.textContent = attackSource || 'Unknown';
                        attackSourceElement.classList.add('fallback-detail');
                    }
                });
        });
        </script>
    </div>
</body>
</html>
